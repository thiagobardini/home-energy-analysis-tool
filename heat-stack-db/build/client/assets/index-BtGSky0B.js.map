{"version":3,"file":"index-BtGSky0B.js","sources":["../../../app/routes/users+/index.tsx"],"sourcesContent":["import { json, redirect, type LoaderFunctionArgs } from '@remix-run/node'\nimport { Link, useLoaderData } from '@remix-run/react'\nimport { z } from 'zod'\nimport { GeneralErrorBoundary } from '#app/components/error-boundary.tsx'\nimport { ErrorList } from '#app/components/forms.tsx'\nimport { SearchBar } from '#app/components/search-bar.tsx'\nimport { prisma } from '#app/utils/db.server.ts'\nimport { cn, getUserImgSrc, useDelayedIsPending } from '#app/utils/misc.tsx'\n\nconst UserSearchResultSchema = z.object({\n\tid: z.string(),\n\tusername: z.string(),\n\tname: z.string().nullable(),\n\timageId: z.string().nullable(),\n})\n\nconst UserSearchResultsSchema = z.array(UserSearchResultSchema)\n\nexport async function loader({ request }: LoaderFunctionArgs) {\n\tconst searchTerm = new URL(request.url).searchParams.get('search')\n\tif (searchTerm === '') {\n\t\treturn redirect('/users')\n\t}\n\n\tconst like = `%${searchTerm ?? ''}%`\n\tconst rawUsers = await prisma.$queryRaw`\n\t\tSELECT User.id, User.username, User.name, UserImage.id AS imageId\n\t\tFROM User\n\t\tLEFT JOIN UserImage ON User.id = UserImage.userId\n\t\tWHERE User.username LIKE ${like}\n\t\tOR User.name LIKE ${like}\n\t\tORDER BY (\n\t\t\tSELECT Note.updatedAt\n\t\t\tFROM Note\n\t\t\tWHERE Note.ownerId = User.id\n\t\t\tORDER BY Note.updatedAt DESC\n\t\t\tLIMIT 1\n\t\t) DESC\n\t\tLIMIT 50\n\t`\n\n\tconst result = UserSearchResultsSchema.safeParse(rawUsers)\n\tif (!result.success) {\n\t\treturn json({ status: 'error', error: result.error.message } as const, {\n\t\t\tstatus: 400,\n\t\t})\n\t}\n\treturn json({ status: 'idle', users: result.data } as const)\n}\n\nexport default function UsersRoute() {\n\tconst data = useLoaderData<typeof loader>()\n\tconst isPending = useDelayedIsPending({\n\t\tformMethod: 'GET',\n\t\tformAction: '/users',\n\t})\n\n\tif (data.status === 'error') {\n\t\tconsole.error(data.error)\n\t}\n\n\treturn (\n\t\t<div className=\"container mb-48 mt-36 flex flex-col items-center justify-center gap-6\">\n\t\t\t<h1 className=\"text-h1\">Epic Notes Users</h1>\n\t\t\t<div className=\"w-full max-w-[700px]\">\n\t\t\t\t<SearchBar status={data.status} autoFocus autoSubmit />\n\t\t\t</div>\n\t\t\t<main>\n\t\t\t\t{data.status === 'idle' ? (\n\t\t\t\t\tdata.users.length ? (\n\t\t\t\t\t\t<ul\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t'flex w-full flex-wrap items-center justify-center gap-4 delay-200',\n\t\t\t\t\t\t\t\t{ 'opacity-50': isPending },\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{data.users.map(user => (\n\t\t\t\t\t\t\t\t<li key={user.id}>\n\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\tto={user.username}\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex h-36 w-44 flex-col items-center justify-center rounded-lg bg-muted px-5 py-3\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\talt={user.name ?? user.username}\n\t\t\t\t\t\t\t\t\t\t\tsrc={getUserImgSrc(user.imageId)}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-16 w-16 rounded-full\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{user.name ? (\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"w-full overflow-hidden text-ellipsis whitespace-nowrap text-center text-body-md\">\n\t\t\t\t\t\t\t\t\t\t\t\t{user.name}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t) : null}\n\t\t\t\t\t\t\t\t\t\t<span className=\"w-full overflow-hidden text-ellipsis text-center text-body-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t{user.username}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<p>No users found</p>\n\t\t\t\t\t)\n\t\t\t\t) : data.status === 'error' ? (\n\t\t\t\t\t<ErrorList errors={['There was an error parsing the results']} />\n\t\t\t\t) : null}\n\t\t\t</main>\n\t\t</div>\n\t)\n}\n\nexport function ErrorBoundary() {\n\treturn <GeneralErrorBoundary />\n}\n"],"names":["UsersRoute","data","useLoaderData","isPending","useDelayedIsPending","formMethod","formAction","status","console","error","jsxs","className","children","jsx","SearchBar","autoFocus","autoSubmit","users","length","cn","map","user","Link","to","username","alt","name","src","getUserImgSrc","imageId","id","ErrorList","errors","ErrorBoundary","GeneralErrorBoundary"],"mappings":"qiBAkDA,SAAwBA,GAAa,CACpC,MAAMC,EAAOC,IACPC,EAAYC,EAAoB,CACrCC,WAAY,MACZC,WAAY,QACb,CAAC,EAEG,OAAAL,EAAKM,SAAW,SACXC,QAAAC,MAAMR,EAAKQ,KAAK,EAIxBC,EAAAA,KAAC,MAAI,CAAAC,UAAU,wEACdC,SAAA,CAACC,EAAA,IAAA,KAAA,CAAGF,UAAU,UAAUC,SAAgB,kBAAA,CAAA,EACvCC,EAAA,IAAA,MAAA,CAAIF,UAAU,uBACdC,SAACC,EAAA,IAAAC,EAAA,CAAUP,OAAQN,EAAKM,OAAQQ,UAAS,GAACC,WAAU,GAAC,CACtD,CAAA,QACC,OACC,CAAAJ,SAAAX,EAAKM,SAAW,OAChBN,EAAKgB,MAAMC,OACVL,EAAA,IAAC,KAAA,CACAF,UAAWQ,EACV,oEACA,CAAE,aAAchB,CAAU,CAC3B,EAECS,SAAKX,EAAAgB,MAAMG,IAAIC,SACd,KACA,CAAAT,SAAAF,EAAA,KAACY,EAAA,CACAC,GAAIF,EAAKG,SACTb,UAAU,oFAEVC,SAAA,CAAAC,EAAA,IAAC,MAAA,CACAY,IAAKJ,EAAKK,MAAQL,EAAKG,SACvBG,IAAKC,EAAcP,EAAKQ,OAAO,EAC/BlB,UAAU,wBACX,CAAA,EACCU,EAAKK,KACJb,EAAAA,IAAA,OAAA,CAAKF,UAAU,kFACdC,SAAAS,EAAKK,KACP,EACG,KACHb,EAAA,IAAA,OAAA,CAAKF,UAAU,sFACdC,WAAKY,QACP,CAAA,CAAA,EACD,CAAA,EAlBQH,EAAKS,EAmBd,CACA,CAAA,CACF,EAEAjB,EAAA,IAAC,IAAE,CAAAD,SAAA,gBAAc,CAAA,EAEfX,EAAKM,SAAW,QACnBM,EAAAA,IAACkB,GAAUC,OAAQ,CAAC,wCAAwC,CAAG,CAAA,EAC5D,IACL,CAAA,CAAA,CACD,CAAA,CAEF,CAEO,SAASC,GAAgB,CAC/B,aAAQC,EAAqB,CAAA,CAAA,CAC9B"}