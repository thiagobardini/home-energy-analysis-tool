{"version":3,"file":"profile.two-factor.index-D9TY_bOs.js","sources":["../../../app/routes/settings+/profile.two-factor.index.tsx"],"sourcesContent":["import { type SEOHandle } from '@nasa-gcn/remix-seo'\nimport {\n\tjson,\n\tredirect,\n\ttype LoaderFunctionArgs,\n\ttype ActionFunctionArgs,\n} from '@remix-run/node'\nimport { Link, useFetcher, useLoaderData } from '@remix-run/react'\nimport { Icon } from '#app/components/ui/icon.tsx'\nimport { StatusButton } from '#app/components/ui/status-button.tsx'\nimport { requireUserId } from '#app/utils/auth.server.ts'\nimport { prisma } from '#app/utils/db.server.ts'\nimport { generateTOTP } from '#app/utils/totp.server.ts'\nimport { twoFAVerificationType } from './profile.two-factor.tsx'\nimport { twoFAVerifyVerificationType } from './profile.two-factor.verify.tsx'\n\nexport const handle: SEOHandle = {\n\tgetSitemapEntries: () => null,\n}\n\nexport async function loader({ request }: LoaderFunctionArgs) {\n\tconst userId = await requireUserId(request)\n\tconst verification = await prisma.verification.findUnique({\n\t\twhere: { target_type: { type: twoFAVerificationType, target: userId } },\n\t\tselect: { id: true },\n\t})\n\treturn json({ is2FAEnabled: Boolean(verification) })\n}\n\nexport async function action({ request }: ActionFunctionArgs) {\n\tconst userId = await requireUserId(request)\n\tconst { otp: _otp, ...config } = generateTOTP()\n\tconst verificationData = {\n\t\t...config,\n\t\ttype: twoFAVerifyVerificationType,\n\t\ttarget: userId,\n\t}\n\tawait prisma.verification.upsert({\n\t\twhere: {\n\t\t\ttarget_type: { target: userId, type: twoFAVerifyVerificationType },\n\t\t},\n\t\tcreate: verificationData,\n\t\tupdate: verificationData,\n\t})\n\treturn redirect('/settings/profile/two-factor/verify')\n}\n\nexport default function TwoFactorRoute() {\n\tconst data = useLoaderData<typeof loader>()\n\tconst enable2FAFetcher = useFetcher<typeof action>()\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-4\">\n\t\t\t{data.is2FAEnabled ? (\n\t\t\t\t<>\n\t\t\t\t\t<p className=\"text-lg\">\n\t\t\t\t\t\t<Icon name=\"check\">\n\t\t\t\t\t\t\tYou have enabled two-factor authentication.\n\t\t\t\t\t\t</Icon>\n\t\t\t\t\t</p>\n\t\t\t\t\t<Link to=\"disable\">\n\t\t\t\t\t\t<Icon name=\"lock-open-1\">Disable 2FA</Icon>\n\t\t\t\t\t</Link>\n\t\t\t\t</>\n\t\t\t) : (\n\t\t\t\t<>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<Icon name=\"lock-open-1\">\n\t\t\t\t\t\t\tYou have not enabled two-factor authentication yet.\n\t\t\t\t\t\t</Icon>\n\t\t\t\t\t</p>\n\t\t\t\t\t<p className=\"text-sm\">\n\t\t\t\t\t\tTwo factor authentication adds an extra layer of security to your\n\t\t\t\t\t\taccount. You will need to enter a code from an authenticator app\n\t\t\t\t\t\tlike{' '}\n\t\t\t\t\t\t<a className=\"underline\" href=\"https://1password.com/\">\n\t\t\t\t\t\t\t1Password\n\t\t\t\t\t\t</a>{' '}\n\t\t\t\t\t\tto log in.\n\t\t\t\t\t</p>\n\t\t\t\t\t<enable2FAFetcher.Form method=\"POST\">\n\t\t\t\t\t\t<StatusButton\n\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\tname=\"intent\"\n\t\t\t\t\t\t\tvalue=\"enable\"\n\t\t\t\t\t\t\tstatus={enable2FAFetcher.state === 'loading' ? 'pending' : 'idle'}\n\t\t\t\t\t\t\tclassName=\"mx-auto\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tEnable 2FA\n\t\t\t\t\t\t</StatusButton>\n\t\t\t\t\t</enable2FAFetcher.Form>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t)\n}\n"],"names":["handle","getSitemapEntries","TwoFactorRoute","data","useLoaderData","enable2FAFetcher","useFetcher","className","children","is2FAEnabled","jsxs","Fragment","jsx","Icon","name","Link","to","href","Form","method","StatusButton","type","value","status","state"],"mappings":"0WAgBO,MAAMA,EAAoB,CAChCC,kBAAmBA,IAAM,IAC1B,EA6BA,SAAwBC,GAAiB,CACxC,MAAMC,EAAOC,IACPC,EAAmBC,IAEzB,aACE,MAAI,CAAAC,UAAU,sBACbC,SAAAL,EAAKM,aAEJC,EAAAA,KAAAC,EAAAA,SAAA,CAAAH,SAAA,CAACI,EAAA,IAAA,IAAA,CAAEL,UAAU,UACZC,SAAAI,EAAA,IAACC,GAAKC,KAAK,QAAQN,uDAEnB,CACD,CAAA,EACAI,EAAA,IAACG,GAAKC,GAAG,UACRR,eAACK,EAAK,CAAAC,KAAK,cAAcN,SAAA,cAAW,CACrC,CAAA,CAAA,CAAA,CACD,EAGCE,EAAA,KAAAC,WAAA,CAAAH,SAAA,CAAAI,EAAA,IAAC,KACAJ,SAACI,EAAA,IAAAC,EAAA,CAAKC,KAAK,cAAcN,+DAEzB,CACD,CAAA,EACAE,EAAA,KAAC,IAAE,CAAAH,UAAU,UAAUC,SAAA,CAAA,0IAGjB,UACJ,IAAE,CAAAD,UAAU,YAAYU,KAAK,yBAAyBT,SAEvD,WAAA,CAAA,EAAK,IAAI,YAAA,EAEV,EACCI,EAAAA,IAAAP,EAAiBa,KAAjB,CAAsBC,OAAO,OAC7BX,SAAAI,EAAA,IAACQ,EAAA,CACAC,KAAK,SACLP,KAAK,SACLQ,MAAM,SACNC,OAAQlB,EAAiBmB,QAAU,UAAY,UAAY,OAC3DjB,UAAU,UACVC,SAAA,aAED,CACD,CAAA,CAAA,EACD,CAEF,CAAA,CAEF"}