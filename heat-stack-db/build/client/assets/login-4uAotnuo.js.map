{"version":3,"file":"login-4uAotnuo.js","sources":["../../../app/routes/_auth+/login.tsx"],"sourcesContent":["import { getFormProps, getInputProps, useForm } from '@conform-to/react'\nimport { getZodConstraint, parseWithZod } from '@conform-to/zod'\nimport {\n\tjson,\n\ttype ActionFunctionArgs,\n\ttype LoaderFunctionArgs,\n\ttype MetaFunction,\n} from '@remix-run/node'\nimport { Form, Link, useActionData, useSearchParams } from '@remix-run/react'\nimport { HoneypotInputs } from 'remix-utils/honeypot/react'\nimport { z } from 'zod'\nimport { GeneralErrorBoundary } from '#app/components/error-boundary.tsx'\nimport { CheckboxField, ErrorList, Field } from '#app/components/forms.tsx'\nimport { Spacer } from '#app/components/spacer.tsx'\nimport { StatusButton } from '#app/components/ui/status-button.tsx'\nimport { login, requireAnonymous } from '#app/utils/auth.server.ts'\nimport {\n\tProviderConnectionForm,\n\tproviderNames,\n} from '#app/utils/connections.tsx'\nimport { checkHoneypot } from '#app/utils/honeypot.server.ts'\nimport { useIsPending } from '#app/utils/misc.tsx'\nimport { PasswordSchema, UsernameSchema } from '#app/utils/user-validation.ts'\nimport { handleNewSession } from './login.server.ts'\n\nconst LoginFormSchema = z.object({\n\tusername: UsernameSchema,\n\tpassword: PasswordSchema,\n\tredirectTo: z.string().optional(),\n\tremember: z.boolean().optional(),\n})\n\nexport async function loader({ request }: LoaderFunctionArgs) {\n\tawait requireAnonymous(request)\n\treturn json({})\n}\n\nexport async function action({ request }: ActionFunctionArgs) {\n\tawait requireAnonymous(request)\n\tconst formData = await request.formData()\n\tcheckHoneypot(formData)\n\tconst submission = await parseWithZod(formData, {\n\t\tschema: intent =>\n\t\t\tLoginFormSchema.transform(async (data, ctx) => {\n\t\t\t\tif (intent !== null) return { ...data, session: null }\n\n\t\t\t\tconst session = await login(data)\n\t\t\t\tif (!session) {\n\t\t\t\t\tctx.addIssue({\n\t\t\t\t\t\tcode: z.ZodIssueCode.custom,\n\t\t\t\t\t\tmessage: 'Invalid username or password',\n\t\t\t\t\t})\n\t\t\t\t\treturn z.NEVER\n\t\t\t\t}\n\n\t\t\t\treturn { ...data, session }\n\t\t\t}),\n\t\tasync: true,\n\t})\n\n\tif (submission.status !== 'success' || !submission.value.session) {\n\t\treturn json(\n\t\t\t{ result: submission.reply({ hideFields: ['password'] }) },\n\t\t\t{ status: submission.status === 'error' ? 400 : 200 },\n\t\t)\n\t}\n\n\tconst { session, remember, redirectTo } = submission.value\n\n\treturn handleNewSession({\n\t\trequest,\n\t\tsession,\n\t\tremember: remember ?? false,\n\t\tredirectTo,\n\t})\n}\n\nexport default function LoginPage() {\n\tconst actionData = useActionData<typeof action>()\n\tconst isPending = useIsPending()\n\tconst [searchParams] = useSearchParams()\n\tconst redirectTo = searchParams.get('redirectTo')\n\n\tconst [form, fields] = useForm({\n\t\tid: 'login-form',\n\t\tconstraint: getZodConstraint(LoginFormSchema),\n\t\tdefaultValue: { redirectTo },\n\t\tlastResult: actionData?.result,\n\t\tonValidate({ formData }) {\n\t\t\treturn parseWithZod(formData, { schema: LoginFormSchema })\n\t\t},\n\t\tshouldRevalidate: 'onBlur',\n\t})\n\n\treturn (\n\t\t<div className=\"flex min-h-full flex-col justify-center pb-32 pt-20\">\n\t\t\t<div className=\"mx-auto w-full max-w-md\">\n\t\t\t\t<div className=\"flex flex-col gap-3 text-center\">\n\t\t\t\t\t<h1 className=\"text-h1\">Welcome back!</h1>\n\t\t\t\t\t<p className=\"text-body-md text-muted-foreground\">\n\t\t\t\t\t\tPlease enter your details.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<Spacer size=\"xs\" />\n\n\t\t\t\t<div>\n\t\t\t\t\t<div className=\"mx-auto w-full max-w-md px-8\">\n\t\t\t\t\t\t<Form method=\"POST\" {...getFormProps(form)}>\n\t\t\t\t\t\t\t<HoneypotInputs />\n\t\t\t\t\t\t\t<Field\n\t\t\t\t\t\t\t\tlabelProps={{ children: 'Username' }}\n\t\t\t\t\t\t\t\tinputProps={{\n\t\t\t\t\t\t\t\t\t...getInputProps(fields.username, { type: 'text' }),\n\t\t\t\t\t\t\t\t\tautoFocus: true,\n\t\t\t\t\t\t\t\t\tclassName: 'lowercase',\n\t\t\t\t\t\t\t\t\tautoComplete: 'username',\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\terrors={fields.username.errors}\n\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t<Field\n\t\t\t\t\t\t\t\tlabelProps={{ children: 'Password' }}\n\t\t\t\t\t\t\t\tinputProps={{\n\t\t\t\t\t\t\t\t\t...getInputProps(fields.password, {\n\t\t\t\t\t\t\t\t\t\ttype: 'password',\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tautoComplete: 'current-password',\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\terrors={fields.password.errors}\n\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t<div className=\"flex justify-between\">\n\t\t\t\t\t\t\t\t<CheckboxField\n\t\t\t\t\t\t\t\t\tlabelProps={{\n\t\t\t\t\t\t\t\t\t\thtmlFor: fields.remember.id,\n\t\t\t\t\t\t\t\t\t\tchildren: 'Remember me',\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tbuttonProps={getInputProps(fields.remember, {\n\t\t\t\t\t\t\t\t\t\ttype: 'checkbox',\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\terrors={fields.remember.errors}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\tto=\"/forgot-password\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-body-xs font-semibold\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tForgot password?\n\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t{...getInputProps(fields.redirectTo, { type: 'hidden' })}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<ErrorList errors={form.errors} id={form.errorId} />\n\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-6 pt-3\">\n\t\t\t\t\t\t\t\t<StatusButton\n\t\t\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\t\t\tstatus={isPending ? 'pending' : form.status ?? 'idle'}\n\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t\tdisabled={isPending}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tLog in\n\t\t\t\t\t\t\t\t</StatusButton>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Form>\n\t\t\t\t\t\t<ul className=\"mt-5 flex flex-col gap-5 border-b-2 border-t-2 border-border py-3\">\n\t\t\t\t\t\t\t{providerNames.map(providerName => (\n\t\t\t\t\t\t\t\t<li key={providerName}>\n\t\t\t\t\t\t\t\t\t<ProviderConnectionForm\n\t\t\t\t\t\t\t\t\t\ttype=\"Login\"\n\t\t\t\t\t\t\t\t\t\tproviderName={providerName}\n\t\t\t\t\t\t\t\t\t\tredirectTo={redirectTo}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t<div className=\"flex items-center justify-center gap-2 pt-6\">\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">New here?</span>\n\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\tto={\n\t\t\t\t\t\t\t\t\tredirectTo\n\t\t\t\t\t\t\t\t\t\t? `/signup?${encodeURIComponent(redirectTo)}`\n\t\t\t\t\t\t\t\t\t\t: '/signup'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCreate an account\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n\nexport const meta: MetaFunction = () => {\n\treturn [{ title: 'Login to Epic Notes' }]\n}\n\nexport function ErrorBoundary() {\n\treturn <GeneralErrorBoundary />\n}\n"],"names":["LoginFormSchema","z","object","username","UsernameSchema","password","PasswordSchema","redirectTo","string","optional","remember","boolean","LoginPage","actionData","useActionData","isPending","useIsPending","searchParams","useSearchParams","get","form","fields","useForm","id","constraint","getZodConstraint","defaultValue","lastResult","result","onValidate","formData","parseWithZod","schema","shouldRevalidate","className","children","jsxs","jsx","Spacer","size","Form","method","getFormProps","HoneypotInputs","Field","labelProps","inputProps","getInputProps","type","autoFocus","autoComplete","errors","CheckboxField","htmlFor","buttonProps","Link","to","ErrorList","errorId","StatusButton","status","disabled","map","providerName","ProviderConnectionForm","encodeURIComponent","meta","title","ErrorBoundary","GeneralErrorBoundary"],"mappings":"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"}