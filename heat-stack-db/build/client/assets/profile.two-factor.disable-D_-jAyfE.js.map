{"version":3,"file":"profile.two-factor.disable-D_-jAyfE.js","sources":["../../../app/routes/settings+/profile.two-factor.disable.tsx"],"sourcesContent":["import { type SEOHandle } from '@nasa-gcn/remix-seo'\nimport {\n\tjson,\n\ttype LoaderFunctionArgs,\n\ttype ActionFunctionArgs,\n} from '@remix-run/node'\nimport { useFetcher } from '@remix-run/react'\nimport { Icon } from '#app/components/ui/icon.tsx'\nimport { StatusButton } from '#app/components/ui/status-button.tsx'\nimport { requireRecentVerification } from '#app/routes/_auth+/verify.server.ts'\nimport { requireUserId } from '#app/utils/auth.server.ts'\nimport { prisma } from '#app/utils/db.server.ts'\nimport { useDoubleCheck } from '#app/utils/misc.tsx'\nimport { redirectWithToast } from '#app/utils/toast.server.ts'\nimport { type BreadcrumbHandle } from './profile.tsx'\nimport { twoFAVerificationType } from './profile.two-factor.tsx'\n\nexport const handle: BreadcrumbHandle & SEOHandle = {\n\tbreadcrumb: <Icon name=\"lock-open-1\">Disable</Icon>,\n\tgetSitemapEntries: () => null,\n}\n\nexport async function loader({ request }: LoaderFunctionArgs) {\n\tawait requireRecentVerification(request)\n\treturn json({})\n}\n\nexport async function action({ request }: ActionFunctionArgs) {\n\tawait requireRecentVerification(request)\n\tconst userId = await requireUserId(request)\n\tawait prisma.verification.delete({\n\t\twhere: { target_type: { target: userId, type: twoFAVerificationType } },\n\t})\n\treturn redirectWithToast('/settings/profile/two-factor', {\n\t\ttitle: '2FA Disabled',\n\t\tdescription: 'Two factor authentication has been disabled.',\n\t})\n}\n\nexport default function TwoFactorDisableRoute() {\n\tconst disable2FAFetcher = useFetcher<typeof action>()\n\tconst dc = useDoubleCheck()\n\n\treturn (\n\t\t<div className=\"mx-auto max-w-sm\">\n\t\t\t<disable2FAFetcher.Form method=\"POST\">\n\t\t\t\t<p>\n\t\t\t\t\tDisabling two factor authentication is not recommended. However, if\n\t\t\t\t\tyou would like to do so, click here:\n\t\t\t\t</p>\n\t\t\t\t<StatusButton\n\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\tstatus={disable2FAFetcher.state === 'loading' ? 'pending' : 'idle'}\n\t\t\t\t\t{...dc.getButtonProps({\n\t\t\t\t\t\tclassName: 'mx-auto',\n\t\t\t\t\t\tname: 'intent',\n\t\t\t\t\t\tvalue: 'disable',\n\t\t\t\t\t\ttype: 'submit',\n\t\t\t\t\t})}\n\t\t\t\t>\n\t\t\t\t\t{dc.doubleCheck ? 'Are you sure?' : 'Disable 2FA'}\n\t\t\t\t</StatusButton>\n\t\t\t</disable2FAFetcher.Form>\n\t\t</div>\n\t)\n}\n"],"names":["handle","breadcrumb","jsx","Icon","name","children","getSitemapEntries","TwoFactorDisableRoute","disable2FAFetcher","useFetcher","dc","useDoubleCheck","className","Form","method","StatusButton","variant","status","state","getButtonProps","value","type","doubleCheck"],"mappings":"wWAiBO,MAAMA,EAAuC,CACnDC,WAAYC,EAAA,IAACC,EAAK,CAAAC,KAAK,cAAcC,SAAO,SAAA,CAAA,EAC5CC,kBAAmBA,IAAM,IAC1B,EAmBA,SAAwBC,GAAwB,CAC/C,MAAMC,EAAoBC,IACpBC,EAAKC,IAGV,OAAAT,EAAAA,IAAC,OAAIU,UAAU,mBACdP,gBAACG,EAAkBK,KAAlB,CAAuBC,OAAO,OAC9BT,SAAA,CAAAH,EAAA,IAAC,KAAEG,SAGH,0GAAA,CAAA,EACAH,EAAA,IAACa,EAAA,CACAC,QAAQ,cACRC,OAAQT,EAAkBU,QAAU,UAAY,UAAY,OAC3D,GAAGR,EAAGS,eAAe,CACrBP,UAAW,UACXR,KAAM,SACNgB,MAAO,UACPC,KAAM,QACP,CAAC,EAEAhB,SAAAK,EAAGY,YAAc,gBAAkB,aAAA,CACrC,CAAA,EACD,CACD,CAAA,CAEF"}