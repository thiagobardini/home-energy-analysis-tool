{"version":3,"file":"verify-BYEPBbzA.js","sources":["../../../app/routes/_auth+/verify.tsx"],"sourcesContent":["import { getFormProps, getInputProps, useForm } from '@conform-to/react'\nimport { getZodConstraint, parseWithZod } from '@conform-to/zod'\nimport { type ActionFunctionArgs } from '@remix-run/node'\nimport { Form, useActionData, useSearchParams } from '@remix-run/react'\nimport { HoneypotInputs } from 'remix-utils/honeypot/react'\nimport { z } from 'zod'\nimport { GeneralErrorBoundary } from '#app/components/error-boundary.tsx'\nimport { ErrorList, OTPField } from '#app/components/forms.tsx'\nimport { Spacer } from '#app/components/spacer.tsx'\nimport { StatusButton } from '#app/components/ui/status-button.tsx'\nimport { checkHoneypot } from '#app/utils/honeypot.server.ts'\nimport { useIsPending } from '#app/utils/misc.tsx'\nimport { validateRequest } from './verify.server.ts'\n\nexport const codeQueryParam = 'code'\nexport const targetQueryParam = 'target'\nexport const typeQueryParam = 'type'\nexport const redirectToQueryParam = 'redirectTo'\nconst types = ['onboarding', 'reset-password', 'change-email', '2fa'] as const\nconst VerificationTypeSchema = z.enum(types)\nexport type VerificationTypes = z.infer<typeof VerificationTypeSchema>\n\nexport const VerifySchema = z.object({\n\t[codeQueryParam]: z.string().min(6).max(6),\n\t[typeQueryParam]: VerificationTypeSchema,\n\t[targetQueryParam]: z.string(),\n\t[redirectToQueryParam]: z.string().optional(),\n})\n\nexport async function action({ request }: ActionFunctionArgs) {\n\tconst formData = await request.formData()\n\tcheckHoneypot(formData)\n\treturn validateRequest(request, formData)\n}\n\nexport default function VerifyRoute() {\n\tconst [searchParams] = useSearchParams()\n\tconst isPending = useIsPending()\n\tconst actionData = useActionData<typeof action>()\n\tconst parseWithZoddType = VerificationTypeSchema.safeParse(\n\t\tsearchParams.get(typeQueryParam),\n\t)\n\tconst type = parseWithZoddType.success ? parseWithZoddType.data : null\n\n\tconst checkEmail = (\n\t\t<>\n\t\t\t<h1 className=\"text-h1\">Check your email</h1>\n\t\t\t<p className=\"mt-3 text-body-md text-muted-foreground\">\n\t\t\t\tWe've sent you a code to verify your email address.\n\t\t\t</p>\n\t\t</>\n\t)\n\n\tconst headings: Record<VerificationTypes, React.ReactNode> = {\n\t\tonboarding: checkEmail,\n\t\t'reset-password': checkEmail,\n\t\t'change-email': checkEmail,\n\t\t'2fa': (\n\t\t\t<>\n\t\t\t\t<h1 className=\"text-h1\">Check your 2FA app</h1>\n\t\t\t\t<p className=\"mt-3 text-body-md text-muted-foreground\">\n\t\t\t\t\tPlease enter your 2FA code to verify your identity.\n\t\t\t\t</p>\n\t\t\t</>\n\t\t),\n\t}\n\n\tconst [form, fields] = useForm({\n\t\tid: 'verify-form',\n\t\tconstraint: getZodConstraint(VerifySchema),\n\t\tlastResult: actionData?.result,\n\t\tonValidate({ formData }) {\n\t\t\treturn parseWithZod(formData, { schema: VerifySchema })\n\t\t},\n\t\tdefaultValue: {\n\t\t\tcode: searchParams.get(codeQueryParam),\n\t\t\ttype: type,\n\t\t\ttarget: searchParams.get(targetQueryParam),\n\t\t\tredirectTo: searchParams.get(redirectToQueryParam),\n\t\t},\n\t})\n\n\treturn (\n\t\t<main className=\"container flex flex-col justify-center pb-32 pt-20\">\n\t\t\t<div className=\"text-center\">\n\t\t\t\t{type ? headings[type] : 'Invalid Verification Type'}\n\t\t\t</div>\n\n\t\t\t<Spacer size=\"xs\" />\n\n\t\t\t<div className=\"mx-auto flex w-72 max-w-full flex-col justify-center gap-1\">\n\t\t\t\t<div>\n\t\t\t\t\t<ErrorList errors={form.errors} id={form.errorId} />\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex w-full gap-2\">\n\t\t\t\t\t<Form method=\"POST\" {...getFormProps(form)} className=\"flex-1\">\n\t\t\t\t\t\t<HoneypotInputs />\n\t\t\t\t\t\t<div className=\"flex items-center justify-center\">\n\t\t\t\t\t\t\t<OTPField\n\t\t\t\t\t\t\t\tlabelProps={{\n\t\t\t\t\t\t\t\t\thtmlFor: fields[codeQueryParam].id,\n\t\t\t\t\t\t\t\t\tchildren: 'Code',\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tinputProps={{\n\t\t\t\t\t\t\t\t\t...getInputProps(fields[codeQueryParam], { type: 'text' }),\n\t\t\t\t\t\t\t\t\tautoComplete: 'one-time-code',\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\terrors={fields[codeQueryParam].errors}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t{...getInputProps(fields[typeQueryParam], { type: 'hidden' })}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t{...getInputProps(fields[targetQueryParam], { type: 'hidden' })}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t{...getInputProps(fields[redirectToQueryParam], {\n\t\t\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<StatusButton\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\tstatus={isPending ? 'pending' : form.status ?? 'idle'}\n\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\tdisabled={isPending}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tSubmit\n\t\t\t\t\t\t</StatusButton>\n\t\t\t\t\t</Form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</main>\n\t)\n}\n\nexport function ErrorBoundary() {\n\treturn <GeneralErrorBoundary />\n}\n"],"names":["codeQueryParam","targetQueryParam","typeQueryParam","redirectToQueryParam","types","VerificationTypeSchema","z","enum","VerifySchema","object","string","min","max","optional","VerifyRoute","searchParams","useSearchParams","isPending","useIsPending","actionData","useActionData","parseWithZoddType","safeParse","get","type","success","data","checkEmail","jsxs","Fragment","children","jsx","className","headings","onboarding","form","fields","useForm","id","constraint","getZodConstraint","lastResult","result","onValidate","formData","parseWithZod","schema","defaultValue","code","target","redirectTo","Spacer","size","ErrorList","errors","errorId","Form","method","getFormProps","HoneypotInputs","OTPField","labelProps","htmlFor","inputProps","getInputProps","autoComplete","StatusButton","status","disabled","ErrorBoundary","GeneralErrorBoundary"],"mappings":"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"}