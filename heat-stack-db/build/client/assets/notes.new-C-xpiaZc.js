import{j as e,r as g}from"./jsx-runtime-D1yySo7E.js";import{z as i}from"./index-BeXw7Xwl.js";import{f as N}from"./floating-toolbar-B1U7BWws.js";import{F as y,T as F,E as d,a as I}from"./forms-O3akMyig.js";import{B as f}from"./button-xs8ZcSgc.js";import{I as x}from"./icon-CC3MP7l8.js";import{L as b}from"./label-Bak8eTW5.js";import{S as T}from"./status-button-Bx4F4H9E.js";import{u as P,e as w,c as L}from"./misc-CxaYal_B.js";import{a as S}from"./components-C2HTMhgG.js";import{u as B,F as A,g as E,a as p,b as v,c as R}from"./helpers-CMO8ncdm.js";import{g as C}from"./constraint-BS8S8JXD.js";import{p as M}from"./parse-Cj2OtakU.js";import{F as V}from"./index-CcD7lzrX.js";import"./index-ikwP-usE.js";import"./index-DbU3sxCe.js";import"./tooltip-wwqaYhkn.js";const z=1,k=100,Z=1,D=1e4,O=1024*1024*3,U=i.object({id:i.string().optional(),file:i.instanceof(File).optional().refine(t=>!t||t.size<=O,"File size must be less than 3MB"),altText:i.string().optional()}),j=i.object({id:i.string().optional(),title:i.string().min(z).max(k),content:i.string().min(Z).max(D),images:i.array(U).max(5).optional()});function ne({note:t}){const s=S(),n=P(),[r,a]=B({id:"note-editor",constraint:C(j),lastResult:s==null?void 0:s.result,onValidate({formData:o}){return M(o,{schema:j})},defaultValue:{...t,images:(t==null?void 0:t.images)??[{}]},shouldRevalidate:"onBlur"}),c=a.images.getFieldList();return e.jsx("div",{className:"absolute inset-0",children:e.jsxs(A,{context:r.context,children:[e.jsxs(V,{method:"POST",className:"flex h-full flex-col gap-y-4 overflow-y-auto overflow-x-hidden px-10 pb-28 pt-12",...E(r),encType:"multipart/form-data",children:[e.jsx("button",{type:"submit",className:"hidden"}),t?e.jsx("input",{type:"hidden",name:"id",value:t.id}):null,e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(y,{labelProps:{children:"Title"},inputProps:{autoFocus:!0,...p(a.title,{type:"text"})},errors:a.title.errors}),e.jsx(F,{labelProps:{children:"Content"},textareaProps:{...v(a.content)},errors:a.content.errors}),e.jsxs("div",{children:[e.jsx(b,{children:"Images"}),e.jsx("ul",{className:"flex flex-col gap-4",children:c.map((o,l)=>(console.log("image.key",o.key),e.jsxs("li",{className:"relative border-b-2 border-muted-foreground",children:[e.jsxs("button",{className:"absolute right-0 top-0 text-foreground-destructive",...r.remove.getButtonProps({name:a.images.name,index:l}),children:[e.jsx("span",{"aria-hidden":!0,children:e.jsx(x,{name:"cross-1"})})," ",e.jsxs("span",{className:"sr-only",children:["Remove image ",l+1]})]}),e.jsx(_,{meta:o})]},o.key)))})]}),e.jsxs(f,{className:"mt-3",...r.insert.getButtonProps({name:a.images.name}),children:[e.jsx("span",{"aria-hidden":!0,children:e.jsx(x,{name:"plus",children:"Image"})})," ",e.jsx("span",{className:"sr-only",children:"Add image"})]})]}),e.jsx(d,{id:r.errorId,errors:r.errors})]}),e.jsxs("div",{className:N,children:[e.jsx(f,{variant:"destructive",...r.reset.getButtonProps(),children:"Reset"}),e.jsx(T,{form:r.id,type:"submit",disabled:n,status:n?"pending":"idle",children:"Submit"})]})]})})}function _({meta:t}){const s=t.getFieldset(),n=!!s.id.initialValue,[r,a]=g.useState(s.id.initialValue?w(s.id.initialValue):null),[c,o]=g.useState(s.altText.initialValue??"");return e.jsxs("fieldset",{...R(t),children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"w-32",children:[e.jsx("div",{className:"relative h-32 w-32",children:e.jsxs("label",{htmlFor:s.file.id,className:L("group absolute h-32 w-32 rounded-lg",{"bg-accent opacity-40 focus-within:opacity-100 hover:opacity-100":!r,"cursor-pointer focus-within:ring-2":!n}),children:[r?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r,alt:c??"",className:"h-32 w-32 rounded-lg object-cover"}),n?null:e.jsx("div",{className:"pointer-events-none absolute -right-0.5 -top-0.5 rotate-12 rounded-sm bg-secondary px-2 py-1 text-xs text-secondary-foreground shadow-md",children:"new"})]}):e.jsx("div",{className:"flex h-32 w-32 items-center justify-center rounded-lg border border-muted-foreground text-4xl text-muted-foreground",children:e.jsx(x,{name:"plus"})}),n?e.jsx("input",{...p(s.id,{type:"hidden"})}):null,e.jsx("input",{"aria-label":"Image",className:"absolute left-0 top-0 z-0 h-32 w-32 cursor-pointer opacity-0",onChange:l=>{var h;const u=(h=l.target.files)==null?void 0:h[0];if(u){const m=new FileReader;m.onloadend=()=>{a(m.result)},m.readAsDataURL(u)}else a(null)},accept:"image/*",...p(s.file,{type:"file"})})]})}),e.jsx("div",{className:"min-h-[32px] px-4 pb-3 pt-1",children:e.jsx(d,{id:s.file.errorId,errors:s.file.errors})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(b,{htmlFor:s.altText.id,children:"Alt Text"}),e.jsx(I,{onChange:l=>o(l.currentTarget.value),...v(s.altText)}),e.jsx("div",{className:"min-h-[32px] px-4 pb-3 pt-1",children:e.jsx(d,{id:s.altText.errorId,errors:s.altText.errors})})]})]}),e.jsx("div",{className:"min-h-[32px] px-4 pb-3 pt-1",children:e.jsx(d,{id:t.errorId,errors:t.errors})})]})}export{ne as default};
//# sourceMappingURL=notes.new-C-xpiaZc.js.map
